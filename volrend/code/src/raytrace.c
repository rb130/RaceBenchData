#ifdef __cplusplus
extern "C"
#endif
void racebench_bug0(int);
#ifdef __cplusplus
extern "C"
#endif
void racebench_bug0(int);
#ifdef __cplusplus
extern "C"
#endif
void racebench_bug1(int);
#ifdef __cplusplus
extern "C"
#endif
void racebench_bug1(int);
#ifdef __cplusplus
extern "C"
#endif
void racebench_bug2(int);
#ifdef __cplusplus
extern "C"
#endif
void racebench_bug2(int);
#ifdef __cplusplus
extern "C"
#endif
void racebench_bug3(int);
#ifdef __cplusplus
extern "C"
#endif
void racebench_bug5(int);
#ifdef __cplusplus
extern "C"
#endif
void racebench_bug5(int);
#ifdef __cplusplus
extern "C"
#endif
void racebench_bug6(int);
#ifdef __cplusplus
extern "C"
#endif
void racebench_bug6(int);
#ifdef __cplusplus
extern "C"
#endif
void racebench_bug9(int);
#ifdef __cplusplus
extern "C"
#endif
void racebench_bug9(int);
#ifdef __cplusplus
extern "C"
#endif
void racebench_bug10(int);
#ifdef __cplusplus
extern "C"
#endif
void racebench_bug10(int);
#ifdef __cplusplus
extern "C"
#endif
void racebench_bug12(int);
#ifdef __cplusplus
extern "C"
#endif
void racebench_bug13(int);
#ifdef __cplusplus
extern "C"
#endif
void racebench_bug13(int);
#ifdef __cplusplus
extern "C"
#endif
void racebench_bug18(int);
#ifdef __cplusplus
extern "C"
#endif
void racebench_bug18(int);
#ifdef __cplusplus
extern "C"
#endif
void racebench_bug19(int);
#ifdef __cplusplus
extern "C"
#endif
void racebench_bug19(int);
#ifdef __cplusplus
extern "C"
#endif
void racebench_bug20(int);
#ifdef __cplusplus
extern "C"
#endif
void racebench_bug20(int);
#ifdef __cplusplus
extern "C"
#endif
void racebench_bug22(int);
#ifdef __cplusplus
extern "C"
#endif
void racebench_bug22(int);
#ifdef __cplusplus
extern "C"
#endif
void racebench_bug24(int);
#ifdef __cplusplus
extern "C"
#endif
void racebench_bug24(int);
#ifdef __cplusplus
extern "C"
#endif
void racebench_bug25(int);
#ifdef __cplusplus
extern "C"
#endif
void racebench_bug25(int);
#ifdef __cplusplus
extern "C"
#endif
void racebench_bug26(int);
#ifdef __cplusplus
extern "C"
#endif
void racebench_bug26(int);
#ifdef __cplusplus
extern "C"
#endif
void racebench_bug29(int);
#ifdef __cplusplus
extern "C"
#endif
void racebench_bug29(int);
#ifdef __cplusplus
extern "C"
#endif
void racebench_bug32(int);
#ifdef __cplusplus
extern "C"
#endif
void racebench_bug32(int);
#ifdef __cplusplus
extern "C"
#endif
void racebench_bug34(int);
#ifdef __cplusplus
extern "C"
#endif
void racebench_bug34(int);
#ifdef __cplusplus
extern "C"
#endif
void racebench_bug35(int);
#ifdef __cplusplus
extern "C"
#endif
void racebench_bug35(int);
#ifdef __cplusplus
extern "C"
#endif
void racebench_bug36(int);
#ifdef __cplusplus
extern "C"
#endif
void racebench_bug36(int);
#ifdef __cplusplus
extern "C"
#endif
void racebench_bug37(int);
#ifdef __cplusplus
extern "C"
#endif
void racebench_bug37(int);
#ifdef __cplusplus
extern "C"
#endif
void racebench_bug38(int);
#ifdef __cplusplus
extern "C"
#endif
void racebench_bug38(int);
#ifdef __cplusplus
extern "C"
#endif
void racebench_bug41(int);
#ifdef __cplusplus
extern "C"
#endif
void racebench_bug41(int);
#ifdef __cplusplus
extern "C"
#endif
void racebench_bug42(int);
#ifdef __cplusplus
extern "C"
#endif
void racebench_bug42(int);
#ifdef __cplusplus
extern "C"
#endif
void racebench_bug43(int);
#ifdef __cplusplus
extern "C"
#endif
void racebench_bug44(int);
#ifdef __cplusplus
extern "C"
#endif
void racebench_bug44(int);
#ifdef __cplusplus
extern "C"
#endif
void racebench_bug45(int);
#ifdef __cplusplus
extern "C"
#endif
void racebench_bug45(int);
#ifdef __cplusplus
extern "C"
#endif
void racebench_bug47(int);
#ifdef __cplusplus
extern "C"
#endif
void racebench_bug47(int);
#ifdef __cplusplus
extern "C"
#endif
void racebench_bug48(int);
#ifdef __cplusplus
extern "C"
#endif
void racebench_bug48(int);
#ifdef __cplusplus
extern "C"
#endif
void racebench_bug49(int);
#ifdef __cplusplus
extern "C"
#endif
void racebench_bug49(int);
#ifdef __cplusplus
extern "C"
#endif
void racebench_bug50(int);
#ifdef __cplusplus
extern "C"
#endif
void racebench_bug50(int);
#ifdef __cplusplus
extern "C"
#endif
void racebench_bug51(int);
#ifdef __cplusplus
extern "C"
#endif
void racebench_bug51(int);
#ifdef __cplusplus
extern "C"
#endif
void racebench_bug53(int);
#ifdef __cplusplus
extern "C"
#endif
void racebench_bug53(int);
#ifdef __cplusplus
extern "C"
#endif
void racebench_bug54(int);
#ifdef __cplusplus
extern "C"
#endif
void racebench_bug54(int);
#ifdef __cplusplus
extern "C"
#endif
void racebench_bug55(int);
#ifdef __cplusplus
extern "C"
#endif
void racebench_bug56(int);
#ifdef __cplusplus
extern "C"
#endif
void racebench_bug56(int);
#ifdef __cplusplus
extern "C"
#endif
void racebench_bug57(int);
#ifdef __cplusplus
extern "C"
#endif
void racebench_bug57(int);
#ifdef __cplusplus
extern "C"
#endif
void racebench_bug58(int);
#ifdef __cplusplus
extern "C"
#endif
void racebench_bug58(int);
#ifdef __cplusplus
extern "C"
#endif
void racebench_bug60(int);
#ifdef __cplusplus
extern "C"
#endif
void racebench_bug60(int);
#ifdef __cplusplus
extern "C"
#endif
void racebench_bug61(int);
#ifdef __cplusplus
extern "C"
#endif
void racebench_bug61(int);
#ifdef __cplusplus
extern "C"
#endif
void racebench_bug64(int);
#ifdef __cplusplus
extern "C"
#endif
void racebench_bug64(int);
#ifdef __cplusplus
extern "C"
#endif
void racebench_bug68(int);
#ifdef __cplusplus
extern "C"
#endif
void racebench_bug68(int);
#ifdef __cplusplus
extern "C"
#endif
void racebench_bug69(int);
#ifdef __cplusplus
extern "C"
#endif
void racebench_bug70(int);
#ifdef __cplusplus
extern "C"
#endif
void racebench_bug70(int);
#ifdef __cplusplus
extern "C"
#endif
void racebench_bug71(int);
#ifdef __cplusplus
extern "C"
#endif
void racebench_bug71(int);
#ifdef __cplusplus
extern "C"
#endif
void racebench_bug72(int);
#ifdef __cplusplus
extern "C"
#endif
void racebench_bug72(int);
#ifdef __cplusplus
extern "C"
#endif
void racebench_bug73(int);
#ifdef __cplusplus
extern "C"
#endif
void racebench_bug73(int);
#ifdef __cplusplus
extern "C"
#endif
void racebench_bug74(int);
#ifdef __cplusplus
extern "C"
#endif
void racebench_bug77(int);
#ifdef __cplusplus
extern "C"
#endif
void racebench_bug77(int);
#ifdef __cplusplus
extern "C"
#endif
void racebench_bug79(int);
#ifdef __cplusplus
extern "C"
#endif
void racebench_bug79(int);
#ifdef __cplusplus
extern "C"
#endif
void racebench_bug81(int);
#ifdef __cplusplus
extern "C"
#endif
void racebench_bug81(int);
#ifdef __cplusplus
extern "C"
#endif
void racebench_bug82(int);
#ifdef __cplusplus
extern "C"
#endif
void racebench_bug83(int);
#ifdef __cplusplus
extern "C"
#endif
void racebench_bug83(int);
#ifdef __cplusplus
extern "C"
#endif
void racebench_bug84(int);
#ifdef __cplusplus
extern "C"
#endif
void racebench_bug84(int);
#ifdef __cplusplus
extern "C"
#endif
void racebench_bug85(int);
#ifdef __cplusplus
extern "C"
#endif
void racebench_bug85(int);
#ifdef __cplusplus
extern "C"
#endif
void racebench_bug86(int);
#ifdef __cplusplus
extern "C"
#endif
void racebench_bug86(int);
#ifdef __cplusplus
extern "C"
#endif
void racebench_bug87(int);
#ifdef __cplusplus
extern "C"
#endif
void racebench_bug87(int);
#ifdef __cplusplus
extern "C"
#endif
void racebench_bug88(int);
#ifdef __cplusplus
extern "C"
#endif
void racebench_bug89(int);
#ifdef __cplusplus
extern "C"
#endif
void racebench_bug89(int);
#ifdef __cplusplus
extern "C"
#endif
void racebench_bug90(int);
#ifdef __cplusplus
extern "C"
#endif
void racebench_bug90(int);
#ifdef __cplusplus
extern "C"
#endif
void racebench_bug91(int);
#ifdef __cplusplus
extern "C"
#endif
void racebench_bug91(int);
#ifdef __cplusplus
extern "C"
#endif
void racebench_bug94(int);
#ifdef __cplusplus
extern "C"
#endif
void racebench_bug95(int);
#ifdef __cplusplus
extern "C"
#endif
void racebench_bug95(int);
#ifdef __cplusplus
extern "C"
#endif
void racebench_bug98(int);
#ifdef __cplusplus
extern "C"
#endif
void racebench_bug98(int);
#ifdef __cplusplus
extern "C"
#endif
void racebench_bug99(int);
#ifdef __cplusplus
extern "C"
#endif
void racebench_bug99(int);

#include "incl.h"

extern int num_traced_rays_hit_volume;
extern int num_samples_trilirped;
extern int traversal_time, trilirp_time, init_time, composite_time;

#define VXEL(X, SIGN) ((SIGN) > 0 ? (int)((X) + SMALL) : (int)((X)-SMALL))

#define SBIT_ADDRESS(TA) (sbit_address + (TA))
#define SHD_ADDRESS(TA) (shd_address + (TA))
#define SBIT(TA) (*SBIT_ADDRESS(TA))
#define SHD(TA) (*SHD_ADDRESS(TA))

#include <pthread.h>
#include <sys/time.h>
#include <unistd.h>
#include <stdlib.h>
#include <stdio.h>
extern pthread_t PThreadTable[];

Trace_Ray(outx, outy, foutx, fouty, pixel_address) int outx, outy;
float foutx, fouty;
PIXEL *pixel_address;
{
    float ray[2][NM];

    float rmin, rmax;

    float ray_min, ray_max;

    int segment_zmin, segment_zmax;
    int span_zmin, span_zmax;
    float sample[NM], sample2[NM];
    int outz;
    int i, samplex, sampley, samplez;
    int sample2x, sample2y, sample2z;

    float box_zmin, box_zmax;
    int starting_level, level;
    float jump[NM], min_jump;
    float voxel[NM], next_voxel[NM];
    int ivoxel[NM], next_ivoxel[NM];
    BOOLEAN bit;

    float xalpha, yalpha, zalpha;
    float one_minus_xalpha, one_minus_yalpha, one_minus_zalpha;
    float weight, wopacity, wopacitysum, wcolorsum;
    int table_addr, xnorm, ynorm, znorm;
    float normal[NM], wnormalsum[NM];
    float inv_magnitude, magnitude;
    float additional_opacity;
    float dot_product, diffuse, specular;

    float color;
    float opacity;
    float ray_color, ray_opacity;

    OPACITY *local_opc_address, *local2_opc_address;
    NORMAL *local_norm_address, *local2_norm_address;

    long pyr_offset1;
    long pyr_offset2;
    BYTE *pyr_address2;

    ray_color = (float)MIN_PIXEL; racebench_bug12(0); racebench_bug55(1); racebench_bug88(0); racebench_bug94(0);
    ray_opacity = MIN_OPACITY; racebench_bug3(1); racebench_bug32(0); racebench_bug37(1); racebench_bug38(1); racebench_bug69(0); racebench_bug82(0);

    for (i = 0; i < NM; i++) {
        ray[0][i] = out_invvertex[0][0][0][i] + invjacobian[X][i] * foutx + invjacobian[Y][i] * fouty; racebench_bug38(0); racebench_bug56(1); racebench_bug72(0); racebench_bug72(1); racebench_bug74(0);
        ray[1][i] = ray[0][i] + invjacobian[Z][i] * image_zlen;
    }

    ray_min = 0.0;
    ray_max = 1.0;
    for (i = 0; i < NM; i++) {
        if (ABS(ray[1][i] - ray[0][i]) < SMALL) {
            if ((ray[0][i] < 0.0 && ray[1][i] < 0.0) || (ray[0][i] > (float)(opc_len[i] - 1) && ray[1][i] > (float)(opc_len[i] - 1))) {
                return;
            } else {
                continue;
            }
        }
        rmin = (0.0 - ray[0][i]) / (ray[1][i] - ray[0][i]);
        rmax = ((float)(opc_len[i] - 1) - ray[0][i]) / (ray[1][i] - ray[0][i]); racebench_bug22(0); racebench_bug73(0); racebench_bug73(1); racebench_bug90(1);
        ray_min = MAX(MIN(rmin, rmax), ray_min); racebench_bug90(0);
        ray_max = MIN(MAX(rmin, rmax), ray_max); racebench_bug22(1); racebench_bug45(1);
    }

    segment_zmin = ROUNDUP(image_zlen * ray_min);
    segment_zmax = ROUNDDOWN(image_zlen * ray_max); racebench_bug13(0); racebench_bug13(1); racebench_bug35(0); racebench_bug35(1);

    if (segment_zmax < segment_zmin) {
        return;
    }

    box_zmin = (float)segment_zmin;
    voxel[X] = ray[0][X] + invjacobian[Z][X] * box_zmin;
    voxel[Y] = ray[0][Y] + invjacobian[Z][Y] * box_zmin;
    voxel[Z] = ray[0][Z] + invjacobian[Z][Z] * box_zmin;
    ivoxel[X] = VXEL(voxel[X], invjacobian[Z][X]);
    ivoxel[Y] = VXEL(voxel[Y], invjacobian[Z][Y]);
    ivoxel[Z] = VXEL(voxel[Z], invjacobian[Z][Z]);
    starting_level = MIN(pyr_highest_level, pyr_levels - 1);
    level = starting_level;

    while (1) {

        bit = PYR(level, ivoxel[Z] >> level, ivoxel[Y] >> level, ivoxel[X] >> level); racebench_bug5(0); racebench_bug19(1);
        if (bit && level > pyr_lowest_level) {

            level--; racebench_bug5(1); racebench_bug36(1); racebench_bug89(0); racebench_bug89(1);
            continue;
        }

        min_jump = BIG; racebench_bug36(0); racebench_bug58(1); racebench_bug79(0); racebench_bug79(1);
        if (invjacobian[Z][X] > SMALL) {
            jump[X] = invinvjacobian[Z][X] * (((ROUNDDOWN(voxel[X]) >> level) + 1) * pyr_voxlen[level][X] - voxel[X]);
            min_jump = MIN(min_jump, jump[X]);
        } else if (invjacobian[Z][X] < -SMALL) {
            jump[X] = invinvjacobian[Z][X] * ((STEPDOWN(voxel[X]) >> level) * pyr_voxlen[level][X] - voxel[X]);
            min_jump = MIN(min_jump, jump[X]);
        }
        if (invjacobian[Z][Y] > SMALL) {
            jump[Y] = invinvjacobian[Z][Y] * (((ROUNDDOWN(voxel[Y]) >> level) + 1) * pyr_voxlen[level][Y] - voxel[Y]);
            min_jump = MIN(min_jump, jump[Y]); racebench_bug0(0); racebench_bug20(1); racebench_bug50(0);
        } else if (invjacobian[Z][Y] < -SMALL) {
            jump[Y] = invinvjacobian[Z][Y] * ((STEPDOWN(voxel[Y]) >> level) * pyr_voxlen[level][Y] - voxel[Y]);
            min_jump = MIN(min_jump, jump[Y]);
        }
        if (invjacobian[Z][Z] > SMALL) {
            jump[Z] = invinvjacobian[Z][Z] * (((ROUNDDOWN(voxel[Z]) >> level) + 1) * pyr_voxlen[level][Z] - voxel[Z]); racebench_bug25(1); racebench_bug58(0);
            min_jump = MIN(min_jump, jump[Z]); racebench_bug50(1);
        } else if (invjacobian[Z][Z] < -SMALL) {
            jump[Z] = invinvjacobian[Z][Z] * ((STEPDOWN(voxel[Z]) >> level) * pyr_voxlen[level][Z] - voxel[Z]);
            min_jump = MIN(min_jump, jump[Z]);
        }
        box_zmax = box_zmin + min_jump; racebench_bug20(0); racebench_bug25(0);

        if (bit) {

            break;
        }

    next_box:
        if (box_zmax >= (float)segment_zmax) {
            goto end_of_segment;
        }
        box_zmin = box_zmax; racebench_bug49(1);

        next_voxel[X] = voxel[X] + invjacobian[Z][X] * min_jump; racebench_bug61(0);
        next_voxel[Y] = voxel[Y] + invjacobian[Z][Y] * min_jump; racebench_bug24(1); racebench_bug49(0);
        next_voxel[Z] = voxel[Z] + invjacobian[Z][Z] * min_jump; racebench_bug61(1);
        next_ivoxel[X] = VXEL(next_voxel[X], invjacobian[Z][X]); racebench_bug32(1); racebench_bug56(0);
        next_ivoxel[Y] = VXEL(next_voxel[Y], invjacobian[Z][Y]);
        next_ivoxel[Z] = VXEL(next_voxel[Z], invjacobian[Z][Z]); racebench_bug84(0);

        while (level < starting_level) {
            if (next_ivoxel[X] >> (level + 1) != ivoxel[X] >> (level + 1) || next_ivoxel[Y] >> (level + 1) != ivoxel[Y] >> (level + 1) || next_ivoxel[Z] >> (level + 1) != ivoxel[Z] >> (level + 1)) {
                level++; racebench_bug84(1);
            } else {
                break;
            }
        }

        voxel[X] = next_voxel[X];
        voxel[Y] = next_voxel[Y];
        voxel[Z] = next_voxel[Z]; racebench_bug91(0);
        ivoxel[X] = next_ivoxel[X]; racebench_bug19(0);
        ivoxel[Y] = next_ivoxel[Y]; racebench_bug91(1);
        ivoxel[Z] = next_ivoxel[Z]; racebench_bug24(0); racebench_bug34(0); racebench_bug34(1);
    }

    span_zmin = ROUNDUP(box_zmin);
    span_zmax = MIN((int)box_zmax, segment_zmax);

    if (span_zmax < span_zmin) {
        goto next_box;
    }

    sample[X] = ray[0][X] + invjacobian[Z][X] * span_zmin;
    sample[Y] = ray[0][Y] + invjacobian[Z][Y] * span_zmin;
    sample[Z] = ray[0][Z] + invjacobian[Z][Z] * span_zmin;

    for (outz = span_zmin; outz <= span_zmax; outz++) {

        samplex = (int)sample[X];
        sampley = (int)sample[Y];
        samplez = (int)sample[Z];

        bit = PYR(0, samplez, sampley, samplex);
        if (!bit) {
            goto end_of_sample;
        }

        sample2[X] = MIN(sample[X], in_max[X]);
        sample2[Y] = MIN(sample[Y], in_max[Y]);
        sample2[Z] = MIN(sample[Z], in_max[Z]);

        sample2x = (int)sample2[X];
        sample2y = (int)sample2[Y];
        sample2z = (int)sample2[Z];

        xalpha = sample2[X] - sample2x++;
        yalpha = sample2[Y] - sample2y;
        zalpha = sample2[Z] - sample2z;

        local_opc_address = OPC_ADDRESS(sample2z, sample2y, sample2x);
        local_norm_address = NORM_ADDRESS(sample2z, sample2y, sample2x, Z);

        one_minus_xalpha = 1.0 - xalpha;
        one_minus_yalpha = 1.0 - yalpha;
        one_minus_zalpha = 1.0 - zalpha;

        weight = xalpha * one_minus_yalpha * one_minus_zalpha;
        wopacity = *local_opc_address-- * weight;
        color = SHD(*local_norm_address--);
        wcolorsum = color * wopacity;
        wopacitysum = wopacity;

        weight = one_minus_xalpha * one_minus_yalpha * one_minus_zalpha;
        wopacity = *local_opc_address * weight; racebench_bug0(1);
        color = SHD(*local_norm_address);
        wcolorsum += color * wopacity;
        wopacitysum += wopacity;

        weight = xalpha * yalpha * one_minus_zalpha;
        local2_opc_address = local_opc_address + opc_xlen;
        local2_norm_address = local_norm_address + norm_xlen;
        wopacity = *local2_opc_address-- * weight;
        color = SHD(*local2_norm_address--);
        wcolorsum += color * wopacity;
        wopacitysum += wopacity;

        weight = one_minus_xalpha * yalpha * one_minus_zalpha; racebench_bug18(1);
        wopacity = *local2_opc_address * weight; racebench_bug18(0);
        color = SHD(*local2_norm_address);
        wcolorsum += color * wopacity; racebench_bug45(0);
        wopacitysum += wopacity; racebench_bug41(0); racebench_bug41(1);

        weight = xalpha * one_minus_yalpha * zalpha;
        local_opc_address = local_opc_address + opc_xylen;
        local_norm_address = local_norm_address + norm_xylen;
        wopacity = *local_opc_address-- * weight;
        color = SHD(*local_norm_address--);
        wcolorsum += color * wopacity;
        wopacitysum += wopacity;

        weight = one_minus_xalpha * one_minus_yalpha * zalpha;
        wopacity = *local_opc_address * weight; racebench_bug48(0);
        color = SHD(*local_norm_address); racebench_bug2(0); racebench_bug2(1); racebench_bug48(1);
        wcolorsum += color * wopacity;
        wopacitysum += wopacity;

        weight = xalpha * yalpha * zalpha;
        local2_opc_address = local_opc_address + opc_xlen; racebench_bug60(0); racebench_bug60(1);
        local2_norm_address = local_norm_address + norm_xlen;
        wopacity = *local2_opc_address-- * weight;
        color = SHD(*local2_norm_address--);
        wcolorsum += color * wopacity;
        wopacitysum += wopacity;

        weight = one_minus_xalpha * yalpha * zalpha;
        wopacity = *local2_opc_address * weight;
        color = SHD(*local2_norm_address);
        wcolorsum += color * wopacity;
        wopacitysum += wopacity;

        opacity = wopacitysum * INV_MAX_OPC;
        color = wcolorsum * INV_MAX_OPC;

        color *= depth_cueing[outz];

        additional_opacity = opacity * (1.0 - ray_opacity);
        ray_color += color * (1.0 - ray_opacity); racebench_bug99(0); racebench_bug99(1);
        ray_opacity += additional_opacity;

        if (ray_opacity > opacity_cutoff) {
            goto end_of_ray;
        }

    end_of_sample:;
        sample[X] += invjacobian[Z][X];
        sample[Y] += invjacobian[Z][Y]; racebench_bug37(0);
        sample[Z] += invjacobian[Z][Z];
    }

    goto next_box;

end_of_segment:;

    if (ray_opacity <= opacity_epsilon) {
        return;
    }

end_of_ray:;

    additional_opacity = 1.0 - ray_opacity;
    ray_color += *pixel_address * additional_opacity;
    *pixel_address = NINT(ray_color);
}

Pre_Shade(int my_node) {
    int xnorm, ynorm, znorm, table_addr, norm_lshift, i;
    int shd_table_partition, zstart, zstop;
    float mag, error, inv_num_nodes;
    float normal[NM];
    float dot_product, diffuse, specular, color;
    float dpartial_product1, dpartial_product2;
    float spartial_product1, spartial_product2;
    BOOLEAN *local_sbit_address;
    int temp;

    inv_num_nodes = 1.0 / (float)num_nodes; racebench_bug26(0); racebench_bug43(0);

    norm_lshift = NORM_LSHIFT; racebench_bug26(1);
    error = -2.0 * NORM_RSHIFT * NORM_RSHIFT;

    shd_table_partition = ROUNDUP((float)LOOKUP_PREC * inv_num_nodes);
    zstart = -norm_lshift + shd_table_partition * my_node;
    zstop = MIN(zstart + shd_table_partition, norm_lshift + 1);

    for (znorm = zstart; znorm < zstop; znorm++) {
        for (ynorm = -norm_lshift; ynorm <= norm_lshift; ynorm++) {
            normal[Z] = (float)znorm * NORM_RSHIFT; racebench_bug9(1); racebench_bug29(0); racebench_bug68(0);
            normal[Y] = (float)ynorm * NORM_RSHIFT; racebench_bug1(0); racebench_bug9(0); racebench_bug44(0); racebench_bug44(1); racebench_bug68(1); racebench_bug85(0); racebench_bug85(1); racebench_bug95(0);
            mag = 1.0 - normal[Z] * normal[Z] - normal[Y] * normal[Y]; racebench_bug29(1); racebench_bug95(1);
            if (mag > error) {
                mag = MAX(mag, 0.0); racebench_bug1(1);
                normal[X] = sqrt(mag); racebench_bug53(1); racebench_bug57(1);
                xnorm = (int)normal[X]; racebench_bug81(0);
                dpartial_product1 = normal[Z] * obslight[Z] + normal[Y] * obslight[Y]; racebench_bug57(0);
                dpartial_product2 = normal[X] * obslight[X];
                spartial_product1 = normal[Z] * obshighlight[Z] + normal[Y] * obshighlight[Y]; racebench_bug10(0); racebench_bug10(1); racebench_bug98(1);
                spartial_product2 = normal[X] * obshighlight[X]; racebench_bug81(1);
                table_addr = LOOKUP_HSIZE + (znorm * LOOKUP_PREC + ynorm) * 2; racebench_bug54(0); racebench_bug77(0); racebench_bug77(1);
                dot_product = dpartial_product1 + dpartial_product2;
                diffuse = MAX(dot_product, 0.0); racebench_bug54(1);
                dot_product = spartial_product1 + spartial_product2; racebench_bug51(0); racebench_bug51(1);
                specular = MAX(dot_product, 0.0); racebench_bug98(0);
                specular = pow(specular, specular_exponent);
                color = ambient_color + diffuse * diffuse_color + specular * specular_color;
                color = NINT(MIN(color, MAX_PIXEL)); racebench_bug70(1);
                temp = (int)color; racebench_bug42(0); racebench_bug70(0); racebench_bug86(1);
                SHD(table_addr + 1) = (unsigned char)temp; racebench_bug47(0); racebench_bug47(1); racebench_bug64(0); racebench_bug86(0);
                if (normal[X] > 0.0) {
                    dot_product = dpartial_product1 - dpartial_product2;
                    diffuse = MAX(dot_product, 0.0);
                    dot_product = spartial_product1 - spartial_product2;
                    specular = MAX(dot_product, 0.0); racebench_bug42(1);
                    specular = pow(specular, specular_exponent); racebench_bug71(0); racebench_bug71(1);
                    color = ambient_color + diffuse * diffuse_color + specular * specular_color; racebench_bug6(1);
                    color = NINT(MIN(color, MAX_PIXEL));
                }
                temp = (int)color; racebench_bug6(0); racebench_bug53(0);
                SHD(table_addr) = (unsigned char)temp; racebench_bug64(1); racebench_bug83(0); racebench_bug83(1);
            }
        }
    }
    table_addr = LOOKUP_HSIZE + (norm_lshift * LOOKUP_PREC + 2) * 2 + 1;
    temp = (int)ambient_color; racebench_bug87(0); racebench_bug87(1);
    SHD(table_addr) = (unsigned char)temp;
}